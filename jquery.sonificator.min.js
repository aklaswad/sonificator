!function(a){function b(a,b){this.freq=b.freq||440,this.type=b.type||"saw",this.pos=0,this.len=i,this.sr=a.context.sampleRate,this.step=this.len/(this.sr/this.freq)}function c(a,b){this.manager=a,void 0===b&&(b={}),this.init(b)}function d(a){this.cb=a,this.bufferLength=4096,this.context=new webkitAudioContext,this.destination=this.context.destination,this.channels=this.destination.numberOfChannels||this.destination.channelCount,this.node=this.context.createJavaScriptNode(this.bufferLength,2,this.channels),this.init()}function e(){l=l||a('<style type="text/css" id="soniStyle"></style>').appendTo(a("head").eq(0)).get(0).sheet;for(var b=0;b<m.length;b++){var c=m[b];l.insertRule(c,0)}}function f(){for(;l.cssRules.length;)l.deleteRule(0)}var g=140,h={},i=256,j=!0,k=!0;!function(){for(var a=[],b=0;i+1>b;b++)a[b]=Math.sin(b*Math.PI*2/i);h.sine=a}(),function(){for(var a=[],b=0;i+1>b;b++)a[b]=Math.pow(Math.sin(b*Math.PI*2/i),2);h.sine2=a}(),function(){for(var a=[],b=0;i+1>b;b++)a[b]=2*Math.random()-1;h.steel=a}(),function(){for(var a=[],b=0;i+1>b;b++)a[b]=b/i*2-1;h.saw=a}(),b.prototype={setFreq:function(a){return void 0!==a&&(this.freq=a,this.step=this.len/(this.sr/this.freq)),this.freq},get:function(){this.pos+=this.step,this.pos>i&&(this.pos-=Math.floor(this.pos/i)*i);var a=Math.floor(this.pos),b=h[this.type][a],c=h[this.type][a+1];return b+(c-b)*(this.pos-a)}},c.prototype={init:function(a){this.attack=void 0!==a.attack?a.attack:200,this.decay=void 0!==a.decay?a.decay:500,this.sustain=void 0!==a.sustain?a.sustain:.2,this.release=void 0!==a.release?a.release:2e3,this.oscs=[new b(this.manager,{type:"sine"})],this._amp=0,this._noting=!1,this._sounding=!1},noteOn:function(a,b,c){this._noting=!0,this._sounding=!0,this._duration=0,this._release=0,this._attack_ratio=(b-this._amp)/this.attack,this._decay_ratio=(1-this.sustain)/this.decay,this._length=c;for(var d=0;d<this.oscs.length;d++)this.oscs[d].setFreq(a)},noteOff:function(){this._noting=!1,this._release_ratio=this._amp/this.release},get:function(){if(!this._sounding)return 0;this._noting?this._duration<this.attack?this._amp+=this._attack_ratio:this._duration<this.attack+this.decay&&(this._amp-=this._decay_ratio):(this._amp-=this._release_ratio,this._amp<0&&(this._sounding=!1)),this._duration++,this._sounding&&this._length<this._duration&&this.noteOff();for(var a=0,b=0;b<this.oscs.length;b++)a+=this.oscs[b].get()/this.oscs.length;return a*this._amp}},d.prototype={init:function(){var a=this;this.insts={sin:new c(this,{attack:20,decay:2e3,sustain:.3}),sin2:new c(this,{attack:20,decay:4e3,sustain:.01}),seq:new c(this,{}),kick:new c(this,{attack:30,decay:3e3,sustain:.01}),snr:new c(this,{attack:30,decay:2e3,sustain:.01})},this.insts.sin.oscs=[new b(this,{type:"sine"}),new b(this,{type:"sine"})],this.insts.sin.noteOn=function(a,b,c){this.prototype.noteOn.apply(this,[a,b,c]),this.oscs[1].setFreq(.75*a)},this.insts.sin2.oscs=[new b(this,{type:"sine2"}),new b(this,{type:"sine2"})],this.insts.sin2.noteOn=function(a,b,c){this.prototype.noteOn.apply(this,[a,b,c]),this.oscs[1].setFreq(1.5*a)},this.insts.seq.oscs=[new b(this,{type:"saw"}),new b(this,{type:"saw"})],this.insts.seq.noteOn=function(a,b,c){this.prototype.noteOn.apply(this,[a,b,c]),this.oscs[1].setFreq(1.5*a)},this.insts.kick.oscs=[new b(this,{type:"sine"}),new b(this,{type:"sine2"})],this.insts.kick.noteOn=function(a,b){this.prototype.noteOn.apply(this,[180,b,1e4]),this.oscs[1].setFreq(3*a)},this.insts.kick.get=function(){this.oscs[0].setFreq(.9998*this.oscs[0].freq),this.oscs[1].setFreq(.9994*this.oscs[1].freq);var a=this.prototype.get.apply(this);return a*=2.3,a>1&&(a=1),-1>a&&(a=-1),a},this.insts.snr.oscs=[new b(this,{type:"sine2"}),new b(this,{type:"saw"})],this.insts.snr.noteOn=function(a){this.prototype.noteOn.apply(this,[2*a,1,2e3]),this.oscs[1].setFreq(3*a)};var d=0;this.insts.snr.get=function(){var a=this.prototype.get.apply(this);return a+=Math.random()*this._amp*.4,a*=1.3,a>.8&&(a=.8),-.8>a&&(a=-.8),a=(a+d)/2,d=a,a};var e=[],f=0,h=.45,i=0,k="",l="",m="",n="",o="",p="",q=0,r=61.875,s=1.5*r,t=r,u=s;this.node.onaudioprocess=function(b){for(var c=a.cb(a,a.bufferLength),d=new Float32Array(a.bufferLength),v=Math.floor(60*a.context.sampleRate/g*.75),w=0;w<d.length;w++){var x=0,y=c[w];if(y){var z=y.get(0).tagName;j&&("H1"==z?(r*=4/3,s=1.5*r,r>100&&(r/=2),s>100&&(s/=2)):"H2"==z&&(r*=Math.pow(2,10/12),s=1.5*r,r>100&&(r/=2),s>100&&(s/=2)));var A=[];"DIV"==z?A.push("seq"):"A"==z?(A.push("kick"),A.push("seq")):A.push("LI"==z?"sin2":"SPAN"==z?"sin2":"IMG"==z?"snr":"sin"),z==k&&k==l&&l==m?(q++,t=1==q%8?1.5*t:t,u=1==q%6?1.5*u:u,t>2e4&&(t=r),u>1e4&&(u=s),h*=1.01):l==z&&n==l?(q++,t=1==q%6?1.5*t:t,u=1==q%8?2*u:u,t>12e3&&(t=r),u>24e3&&(u=s),h*=1.013):m==z&&m==p?(q++,t=1==q%6?2*t:t,u=1==q%4?2*u:u,t>2e4&&(t=r),u>2e4&&(u=s),h*=1.018):(q=0,t=r,u=s,h=.2),p=o,o=n,n=m,m=l,l=k,k=z,h>.9&&(h=.9);for(var B=0;B<A.length;B++){var C=a.insts[A[B]];C.noteOn(t*(Math.floor(y.width()/90)+1),1,2e3)}}for(var D in a.insts)x+=a.insts[D].get();var E=x;x=(E+i)/2,i=E,x+=(e[f]||0)*h,e[f]=x,f=(f+1)%v,d[w]=x}for(var F=0;F<a.channels;F++){var G=b.outputBuffer.getChannelData(F);G.set(d)}}},play:function(){this.playing||(this.playing=1,this.node.connect(this.destination))},pause:function(){this.playing&&(this.playing=0,this.node.disconnect())}};var l,m=["* {color: #111 !important; background: #000 !important; }","img, object, iframe, embed, input { opacity: 0.1 !important; }",".soni-highlight-0 { background: #fff !important; }",".soni-highlight-1 { background: #aaa !important; }",".soni-highlight-2 { background: #777 !important; }",".soni-highlight-3 { background: #444 !important; }",".soni-highlight-4 { background: #222 !important; }",".soni-highlight-5 { background: #000 !important; }","img.soni-highlight-0, object.soni-highlight-0, iframe.soni-highlight-0, embed.soni-hightlight-0, input.soni-highlight-0 { opacity: 1.0 !important; }","img.soni-highlight-1, object.soni-highlight-1, iframe.soni-highlight-1, embed.soni-hightlight-1, input.soni-highlight-1 { opacity: 0.8 !important; }","img.soni-highlight-2, object.soni-highlight-2, iframe.soni-highlight-2, embed.soni-hightlight-2, input.soni-highlight-2 { opacity: 0.6 !important; }","img.soni-highlight-3, object.soni-highlight-3, iframe.soni-highlight-3, embed.soni-hightlight-3, input.soni-highlight-3 { opacity: 0.4 !important; }","img.soni-highlight-4, object.soni-highlight-4, iframe.soni-highlight-4, embed.soni-hightlight-4, input.soni-highlight-4 { opacity: 0.2 !important; }","img.soni-highlight-5, object.soni-highlight-5, iframe.soni-highlight-5, embed.soni-hightlight-5, input.soni-highlight-5 { opacity: 0.1 !important; }"],n=a("body").eq(0).find("*"),o=[[],[],[],[],[]],p=0,q=0,r=0,s=0,t=function(b,c){if(k){for(var d=5,e=0;5>e;e++){for(var f=(q+e)%5,h=0;h<o[f].length;h++){var i=o[f][h];i.removeClass("soni-highlight-"+(Number(d)-1)),i.addClass("soni-highlight-"+d)}d--}o[q]=[]}for(var j=60*b.context.sampleRate/(4*g),l=[],m={};c>r;r+=j)l.push(r);r-=c;for(var t=0;t<l.length;t++){var u=l[t],v=n.eq(p);p=(p+1)%n.length,v.is(":visible")&&0!==v.height()&&0!==v.width()&&"hidden"!=v.css("visibility")&&(k&&(v.addClass("soni-highlight-0"),o[q].push(v),a(v).offset().top>s+a(window).height()-80?s=a(v).offset().top-.3*a(window).height():a(v).offset().top+a(v).height()<s+80&&(s=a(v).offset().top-.3*a(window).height()),a("html,body").scrollTop(s)),m[Math.floor(u)]=v)}return q=(q+1)%5,m},u=new d(t);a(window).keydown(function(a){if(console.log(a.keyCode),38==a.keyCode)return g+=1,console.log("BPM: "+g),!1;if(40==a.keyCode)return g-=1,console.log("BPM: "+g),!1;if(37==a.keyCode){var b=a.shiftKey?64:8;return p-=b,p=(p+n.length)%n.length,console.log("Rewinded "+b+" elements"),!1}if(39==a.keyCode){var c=a.shiftKey?64:8;return p+=c,p=(p+n.length)%n.length,console.log("Forwarded "+c+" elements"),!1}if(32==a.keyCode)return u.playing?(u.pause(),f()):(u.play(),e()),console.log(u.playing?"Playing":"Paused"),!1;if(27==a.keyCode);else{if(65==a.keyCode)return p=0,console.log("Rewinded to page top"),!1;if(67==a.keyCode)return j=!j,console.log("Change key in H*: "+j),!1}return!0}),e(),a.sonificator=u}(jQuery);